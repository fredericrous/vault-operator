---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: vaulttransitunseals.vault.homelab.io
spec:
  group: vault.homelab.io
  names:
    kind: VaultTransitUnseal
    listKind: VaultTransitUnsealList
    plural: vaulttransitunseals
    singular: vaulttransitunseal
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: VaultTransitUnseal is the Schema for the vaulttransitunseals
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: VaultTransitUnsealSpec defines the desired state of VaultTransitUnseal
            properties:
              argocd:
                description: ArgoCD integration settings
                properties:
                  applicationName:
                    description: |-
                      Application name that manages this operator's CRDs
                      If specified, operator will wait for this application to be healthy
                    type: string
                  enabled:
                    default: false
                    description: |-
                      Enable ArgoCD integration
                      When enabled, CRDs will be managed by ArgoCD instead of the operator
                    type: boolean
                  namespace:
                    default: argocd
                    description: ArgoCD namespace
                    type: string
                  skipCRDInstall:
                    default: true
                    description: Skip CRD installation when ArgoCD integration is
                      enabled
                    type: boolean
                  waitTimeout:
                    default: 5m
                    description: Wait timeout for ArgoCD application to be ready
                    type: string
                type: object
              initialization:
                description: Initialization parameters
                properties:
                  recoveryShares:
                    default: 1
                    description: Number of recovery key shares
                    type: integer
                  recoveryThreshold:
                    default: 1
                    description: Recovery key threshold
                    type: integer
                  secretNames:
                    description: Names for created secrets
                    properties:
                      adminToken:
                        default: vault-admin-token
                        description: Name for admin token secret
                        type: string
                      adminTokenAnnotations:
                        additionalProperties:
                          type: string
                        description: Annotations to add to the admin token secret
                        type: object
                      recoveryKeys:
                        default: vault-keys
                        description: Name for recovery keys secret
                        type: string
                      recoveryKeysAnnotations:
                        additionalProperties:
                          type: string
                        description: Annotations to add to the recovery keys secret
                        type: object
                      storeRecoveryKeys:
                        default: false
                        description: |-
                          Store recovery keys in a secret
                          Set to false for production environments where recovery keys should be handled outside of Kubernetes
                        type: boolean
                    type: object
                type: object
              monitoring:
                description: Monitoring parameters
                properties:
                  checkInterval:
                    default: 30s
                    description: How often to check Vault status
                    type: string
                  retryInterval:
                    default: 10s
                    description: Retry interval for failed operations
                    type: string
                type: object
              postUnsealConfig:
                description: Post-unseal configuration
                properties:
                  enableExternalSecretsOperator:
                    default: true
                    description: Enable External Secrets Operator configuration
                    type: boolean
                  enableKV:
                    default: true
                    description: Enable KV v2 secret engine
                    type: boolean
                  externalSecretsOperatorConfig:
                    description: External Secrets Operator configuration
                    properties:
                      kubernetesAuth:
                        description: Kubernetes auth configuration
                        properties:
                          maxTTL:
                            default: 24h
                            description: Default max TTL
                            type: string
                          roleName:
                            default: external-secrets-operator
                            description: Role name
                            type: string
                          serviceAccounts:
                            description: Service accounts that can authenticate
                            items:
                              description: ServiceAccountRef references a service
                                account
                              properties:
                                name:
                                  description: Service account name
                                  type: string
                                namespace:
                                  description: Namespace
                                  type: string
                              required:
                              - name
                              - namespace
                              type: object
                            type: array
                          ttl:
                            default: 24h
                            description: Default TTL
                            type: string
                        type: object
                      policyName:
                        default: external-secrets-operator
                        description: Policy name
                        type: string
                    type: object
                  kvConfig:
                    description: KV engine configuration
                    properties:
                      deleteVersionAfter:
                        default: 30d
                        description: Delete version after duration (e.g., "30d")
                        type: string
                      maxVersions:
                        default: 5
                        description: Max versions to keep
                        type: integer
                      path:
                        default: secret
                        description: Mount path for KV engine
                        type: string
                      version:
                        default: 2
                        description: KV version
                        type: integer
                    type: object
                type: object
              transitVault:
                description: Transit Vault configuration
                properties:
                  address:
                    description: Transit Vault address (direct value)
                    type: string
                  addressFrom:
                    description: Reference to get the address from ConfigMap or Secret
                    properties:
                      configMapKeyRef:
                        description: Reference to a key in a ConfigMap
                        properties:
                          key:
                            description: Key in the ConfigMap
                            type: string
                          name:
                            description: Name of the ConfigMap
                            type: string
                          namespace:
                            description: Namespace of the ConfigMap (defaults to the
                              namespace of the VaultTransitUnseal)
                            type: string
                        required:
                        - key
                        - name
                        type: object
                      default:
                        description: Default value to use if the reference cannot
                          be resolved
                        type: string
                      secretKeyRef:
                        description: Reference to a key in a Secret
                        properties:
                          key:
                            description: Key in the Secret
                            type: string
                          name:
                            description: Name of the Secret
                            type: string
                          namespace:
                            description: Namespace of the Secret (defaults to the
                              namespace of the VaultTransitUnseal)
                            type: string
                        required:
                        - key
                        - name
                        type: object
                    type: object
                  keyName:
                    default: autounseal
                    description: Transit key name
                    type: string
                  mountPath:
                    default: transit
                    description: Transit mount path
                    type: string
                  secretRef:
                    description: Secret containing transit token
                    properties:
                      key:
                        default: token
                        description: Key in the secret
                        type: string
                      name:
                        description: Name of the secret
                        type: string
                    required:
                    - name
                    type: object
                  tlsSkipVerify:
                    default: true
                    description: Skip TLS verification
                    type: boolean
                required:
                - secretRef
                type: object
              vaultPod:
                description: Vault pods to manage
                properties:
                  namespace:
                    description: Namespace where Vault is deployed
                    type: string
                  selector:
                    additionalProperties:
                      type: string
                    description: Label selector for Vault pods
                    type: object
                required:
                - namespace
                - selector
                type: object
            required:
            - transitVault
            - vaultPod
            type: object
          status:
            description: VaultTransitUnsealStatus defines the observed state of VaultTransitUnseal
            properties:
              conditions:
                description: Current conditions
                items:
                  description: Condition represents the state of a VaultTransitUnseal
                    at a certain point
                  properties:
                    lastTransitionTime:
                      description: Last time the condition transitioned
                      type: string
                    message:
                      description: Human-readable message
                      type: string
                    reason:
                      description: Reason for the condition's last transition
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown
                      type: string
                    type:
                      description: Type of condition
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              configurationStatus:
                description: Configuration status
                properties:
                  externalSecretsOperatorConfigured:
                    description: External Secrets Operator configured
                    type: boolean
                  externalSecretsOperatorConfiguredTime:
                    description: Last time ESO was configured
                    type: string
                  kvConfigured:
                    description: KV engine configured
                    type: boolean
                  kvConfiguredTime:
                    description: Last time KV was configured
                    type: string
                type: object
              initialized:
                description: Whether Vault is initialized
                type: boolean
              lastCheckTime:
                description: Last time Vault status was checked
                type: string
              sealed:
                description: Whether Vault is sealed
                type: boolean
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
